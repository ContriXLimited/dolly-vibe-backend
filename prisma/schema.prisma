generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// Enums
enum ProjectRoleType {
  USER // User
  STAFF // Staff
}

enum ProjectStatus {
  NORMAL // Normal
  DISABLED // Disabled
  DELETED // Deleted
}

enum Platform {
  DISCORD // Discord
  TELEGRAM // Telegram
}

enum UserType {
  USER // User
  STAFF // Staff
}

enum UserStatus {
  NORMAL // Normal
  BLACKLIST // Blacklisted
}

enum AuthorType {
  USER // User
  STAFF // Staff
}

enum Sentiment {
  UNTAGGED // Untagged
  POSITIVE // Positive
  NEUTRAL // Neutral
  NEGATIVE // Negative
}

enum QuestionType {
  QA // QA
  SOP // SOP
}

enum QuestionState {
  IN_PROGRESS // In progress
  RESOLVED // Resolved
  MANUAL_INTERVENTION // Manual intervention (unresolved)
  MANUAL_INTERVENTION_RESOLVED // Resolved after manual intervention
}

enum InteractionType {
  NONE // None
  THUMBS_UP // ğŸ‘ğŸ»
  THUMBS_DOWN // ğŸ‘ğŸ»
}

enum ExecutionType {
  NORMAL_CONVERSATION // Normal conversation
  SOP_CONVERSATION // SOP conversation
}

enum ExecutionState {
  EXECUTING // Executing
  // THINKING // Thinking
  REPLIED // Replied
  INTERRUPTED // Interrupted
  IGNORED // Ignored
  BLOCKED // Blocked
  RECALLED // Recalled
}

enum TaskStatus {
  PENDING // Pending
  SUCCESS // Success
  FAILED // Failed
  RUNNING // Running
}

enum TaskType {
  DEFAULT // 0 é»˜è®¤
  CRAWLER // 1 çˆ¬è™«
  SYNC // 2 åŒæ­¥
  SCHEDULE // 3 å®šæ—¶
}

enum TaskFrequency {
  DAILY // 1 æ¯æ—¥
  WEEKLY // 2 æ¯å‘¨
  MONTHLY // 3 æ¯æœˆ
}

enum TaskExecutionType {
  CRAWLER_SERVICE // å¤–éƒ¨çˆ¬è™«æœåŠ¡ï¼ˆLINKç±»å‹ï¼‰
  NATIVE_API_CALL // ç›´æ¥è°ƒç”¨åŸç”ŸAPIï¼ˆTWITTER/DISCORDç±»å‹ï¼‰
}

enum FileMappingStatus {
  PENDING // Pending
  SUCCESS // Success
  FAILED // Failed
}

enum KnowledgeStatus {
  PENDING // Pending
  PROCESSING // Processing
  PROCESSED // Processed
}

enum KnowledgeType {
  LINK // Link
  DISCORD // Discord
  TELEGRAM // Telegram
  TWITTER // Twitter
  FILE // File
}

enum ClientStatus {
  NORMAL // Normal
  DISABLED // Disabled
  DELETED // Deleted
}

enum ClientProjectRole {
  OWNER // Owner
  ADMIN // Admin
  USER // User
  DEV // Dev
}

enum PaymentStatus {
  PENDING // Pending
  WAITING // Waiting for payment
  CONFIRMING // Confirming
  CONFIRMED // Confirmed
  SENDING // Sending
  PARTIALLY_PAID // Partially paid
  FINISHED // Finished
  FAILED // Failed
  REFUNDED // Refunded
  EXPIRED // Expired
}

enum VIPLimitation {
  AI_ANSWERS // 0 AI å›å¤æ¬¡æ•°
  KNOWLEDGE // 1 Knowledge é¡µé¢å†…å¯é…ç½®çš„ Knowledge ä¸ªæ•°
  CHANNEL // 2 å¯é…ç½®çš„ Readable é¢‘é“ä¸ªæ•°
  SOP // 3 å¯é…ç½®çš„ SOP ä¸ªæ•°
  CUSTOM_WORKFLOW // 4 ä¸ºé¡¹ç›®æ–¹å®šåˆ¶å¼€å‘å·¥ä½œæµ
  TRANSFER_SERVER // 5 DC Guildã€TG Chat ç­‰å¹³å°çš„è¿ç§»æ¬¡æ•°
}

enum TokenChangeType {
  // æ¶ˆè€—åœºæ™¯
  AI_ANSWERS // 0 AI å›å¤æ¬¡æ•°ï¼ˆåªæœ‰å›å¤çš„æ‰ç®—ï¼‰
  REFRESH_TOPICS // 1 åˆ·æ–° Topics å’Œ Questions
  KNOWLEDGE_SYNC // 2 æ¯ä¸ª Knowledge çš„æ¯ä¸€æ¬¡åŒæ­¥æ”¶è´¹ï¼ˆé»˜è®¤æ¯å‘¨ä¸€æ¬¡ï¼‰
  CHANNEL_SYNC // 3 æ¯ä¸ª Readable é¢‘é“çš„æ¯ä¸€æ¬¡åŒæ­¥æ”¶è´¹ï¼ˆé»˜è®¤æ¯å‘¨ä¸€æ¬¡ï¼‰
  PROFILE_UPDATE // 4 ç”¨æˆ·ç”»åƒçš„æ¯ä¸€æ¬¡æ›´æ–°æ”¶è´¹ï¼ˆå¯è®¾ç½®æœ€å¤§å€¼ï¼‰
  CUSTOM_WORKFLOW // 5 ä¸ºé¡¹ç›®æ–¹å®šåˆ¶å¼€å‘å·¥ä½œæµï¼ˆéœ€äººå·¥å¤„ç†ï¼‰
  TRANSFER_SERVER // 6 ä¸åŒé¡¹ç›®çš„è¿ç§»æ¬¡æ•°ï¼ˆéœ€äººå·¥å¤„ç†ï¼‰
  OTHER // 7 å…¶ä»–æ¶ˆè€—æƒ…å†µ

  // å¢åŠ åœºæ™¯
  VIP_GRANT // 10 VIPç­‰çº§èµ é€
  REWARD // 11 å¥–åŠ±
  PURCHASE // 12 è´­ä¹°
}

enum PromptTemplateType {
  JUDGE_REPLY // åˆ¤æ–­å›å¤
  GENERATE_REPLY // ç”Ÿæˆå›å¤
  GENERATE_SOP_REPLY // ç”Ÿæˆ SOP å›å¤
  CORRECT_REPLY // ä¿®æ­£å›å¤

  GENERATE_PROFILE // ç”Ÿæˆä¸ªäººèµ„æ–™

  JUDGE_QUESTION // åˆ¤æ–­é—®é¢˜
  UPDATE_QUESTION // æ›´æ–°é—®é¢˜

  SENTIMENT_ANALYSIS // æƒ…æ„Ÿåˆ†æ
  TOPICS_QUESTIONS // è¯é¢˜é—®é¢˜æå–
}

enum VibeUserStatus {
  NORMAL // æ­£å¸¸
  BLACKLIST // é»‘åå•
}

enum VibeProjectStatus {
  NORMAL // æ­£å¸¸
  BLACKLIST // é»‘åå•
}

enum VibePassStatus {
  NORMAL // æ­£å¸¸
  BLACKLIST // é»‘åå•
}

enum VibeUserParam {
  ENGAGEMENT // æ´»è·ƒåº¦ï¼Œæ ¹æ®æ¯æ—¥å‘è¨€çš„é¢‘ç‡ã€æ¶ˆæ¯æ•°é‡å’Œå†…å®¹é•¿åº¦ï¼Œè¡¡é‡ç”¨æˆ·åœ¨ç¤¾åŒºä¸­çš„æ´»è·ƒæ°´å¹³
  RELEVANCE // ç›¸å…³åº¦ï¼Œè¡¡é‡ç”¨æˆ·å‘è¨€å†…å®¹ä¸é¡¹ç›®ä¸»é¢˜çš„å¥‘åˆåº¦ï¼Œå³ä¸é¡¹ç›®ç›¸å…³çš„æ¶ˆæ¯å æ¯”
  EXPERTISE // ä¸“ä¸šåº¦ï¼Œè¯„ä¼°ç”¨æˆ·å‘è¨€çš„ä¸“ä¸šæ€§å’Œæ·±åº¦ï¼Œæ˜¯å¦åŒ…å«ç‹¬åˆ°è§è§£æˆ–å¯¹é¡¹ç›®æœ‰ä»·å€¼çš„åˆ†æ
  INTERACTION // äº’åŠ¨åº¦ï¼Œè¡¡é‡ç”¨æˆ·ä¸å…¶ä»–æˆå‘˜çš„äº¤æµæƒ…å†µï¼ŒåŒ…æ‹¬æ˜¯å¦åŠæ—¶å›åº”ã€æ˜¯å¦ç§¯æå‚ä¸è®¨è®ºæˆ–å¸®åŠ©ä»–äºº
  CIVILITY // æ–‡æ˜åº¦ï¼Œè¯„ä¼°ç”¨æˆ·å‘è¨€çš„æ–‡æ˜ç¨‹åº¦ï¼ŒåŒ…æ‹¬è¯­æ°”æ˜¯å¦å‹å¥½ã€æ˜¯å¦åˆè§„ã€æ˜¯å¦ä¿æŒå»ºè®¾æ€§æ€åº¦
}

enum ScoreRecordType {
  PROFILE_UPDATE // å› ä¸ºç”¨æˆ·ç”»åƒæ›´æ–°å¯¼è‡´ç§¯åˆ†å˜åŒ–
  SYSTEM // ç³»ç»ŸåŸå› å¯¼è‡´ç§¯åˆ†å˜åŒ–ï¼ˆæ¯”å¦‚ç³»ç»Ÿè°ƒæ•´ï¼‰
}

model User {
  id         String      @id @db.VarChar(64)
  platform   Platform?   @default(DISCORD)
  platformId String?     @db.VarChar(255)
  projectId  String?     @db.VarChar(64)
  type       UserType?   @default(USER)
  name       String?     @db.VarChar(255)
  profile    String?     @db.Text
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  deletedAt  DateTime?
  status     UserStatus? @default(NORMAL)
  roleIds    String?     @db.Text

  @@map("users")
}

model Project {
  id           String         @id @db.VarChar(64)
  name         String         @db.VarChar(255)
  introduction String?        @db.Text
  contacts     String?        @db.Text
  resourceId   String?        @db.VarChar(255)
  docs         String?        @db.LongText
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  deletedAt    DateTime?
  status       ProjectStatus? @default(NORMAL)

  // Discord configuration
  guildId         String? @db.VarChar(255)
  readChannelIds  String? @db.Text
  writeChannelIds String? @db.Text
  ticketChannelId String? @db.VarChar(255)

  // Telegram configuration
  tgChatId       String? @db.VarChar(255) // Telegram Group ID
  readThreadIds  String? @db.Text // JSON array of topic IDs for reading
  writeThreadIds String? @db.Text // JSON array of topic IDs for writing
  threadNames    String? @db.Text // JSON array of thread names

  workflowId   String? @db.VarChar(255)
  roles        String? @db.Text
  blacklist    String? @db.Text
  links        String? @db.Text
  topTopics    String? @db.Text
  topQuestions String? @db.Text

  // Token system
  isTestProject Boolean @default(false) // æ˜¯å¦ä¸ºå†…éƒ¨æµ‹è¯•é¡¹ç›®

  @@map("projects")
}

model Question {
  id          String           @id @db.VarChar(64)
  question    String?          @db.Text
  platform    Platform?        @default(DISCORD)
  projectId   String?          @db.VarChar(64)
  userId      String?          @db.VarChar(64)
  sopId       String?          @db.VarChar(64)
  channelId   String?          @db.VarChar(255)
  messageIds  String?          @db.Text // JSON array of message IDs
  memory      String?          @db.Text
  interaction InteractionType? @default(NONE)
  state       QuestionState?   @default(IN_PROGRESS)
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  deletedAt   DateTime?

  @@map("questions")
}

model QA {
  id        String   @id @db.VarChar(64)
  projectId String?  @db.VarChar(64)
  questions String?  @db.Text
  answer    String?  @db.Text
  prompt    String?  @db.Text
  type      String?  @db.VarChar(255)
  note      String?  @db.Text
  enabled   Boolean? @default(true)
  name      String?  @db.VarChar(255)

  requestCount Int       @default(0)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  deletedAt    DateTime?

  @@map("qas")
}

model SOP {
  id         String    @id @db.VarChar(64)
  projectId  String?   @db.VarChar(64)
  questions  String?   @db.Text
  steps      String?   @db.Text
  workflowId String?   @db.VarChar(255)
  prompt     String?   @db.Text
  type       String?   @db.VarChar(255)
  note       String?   @db.Text
  enabled    Boolean?  @default(true)
  name       String?   @db.VarChar(255)
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  deletedAt  DateTime?

  @@map("sops")
}

model Execution {
  id          String           @id @db.VarChar(64)
  projectId   String?          @db.VarChar(64)
  messageId   String?          @db.VarChar(255)
  message     String?          @db.Text
  reply       String?          @db.Text
  userId      String?          @db.VarChar(64)
  type        ExecutionType?   @default(NORMAL_CONVERSATION)
  state       ExecutionState?  @default(EXECUTING)
  interaction InteractionType? @default(NONE)
  workflowId  String?          @db.VarChar(255)
  likes       Int              @default(0)
  dislikes    Int              @default(0)
  createdAt   DateTime         @default(now())
  repliedAt   DateTime?
  updatedAt   DateTime         @updatedAt
  deletedAt   DateTime?

  @@map("executions")
}

model ExecutionFeedback {
  id          String   @id @db.VarChar(64)
  executionId String   @db.VarChar(64)
  platform    String?  @db.VarChar(64)
  userId      String   @db.VarChar(64)
  isLike      Boolean? @default(true)
  channelId   String?  @db.VarChar(255)
  messageId   String?  @db.VarChar(255)
  guildId     String?  @db.VarChar(255)
  createdAt   DateTime @default(now())

  @@unique([executionId, userId])
  @@map("execution_feedbacks")
}

model Client {
  id           String       @id @db.VarChar(64)
  email        String       @unique @db.VarChar(255)
  passwordHash String       @db.VarChar(255)
  username     String?      @db.VarChar(100)
  avatar       String?      @db.VarChar(255)
  discordId    String?      @unique @db.VarChar(255)
  telegramId   String?      @unique @db.VarChar(255)
  status       ClientStatus @default(NORMAL)
  lastLoginAt  DateTime?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  deletedAt    DateTime?

  @@map("clients")
}

model ClientProject {
  clientId  String            @db.VarChar(64)
  projectId String            @db.VarChar(64)
  role      ClientProjectRole @default(USER)
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt
  deletedAt DateTime?

  @@id([clientId, projectId])
  @@map("client_projects")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model FileMapping {
  id              String             @id @db.VarChar(64)
  fileName        String             @db.VarChar(255)
  fileDescription String?            @db.Text
  docId           String?            @db.VarChar(255)
  status          FileMappingStatus? @default(PENDING)
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  deletedAt       DateTime?

  @@map("file_mapping")
}

model Message {
  id         String      @id @db.VarChar(64)
  platform   Platform?   @default(DISCORD)
  channelId  String?     @db.VarChar(255)
  authorId   String?     @db.VarChar(255)
  projectId  String?     @db.VarChar(64)
  authorType AuthorType? @default(USER)
  message    String?     @db.Text
  docId      String?     @db.VarChar(255)
  sentiment  Sentiment?  @default(UNTAGGED)
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  deletedAt  DateTime?

  @@map("messages")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model Task {
  id            String             @id @db.VarChar(64)
  url           String?            @db.VarChar(2048)
  projectId     String             @db.VarChar(64)
  startTime     DateTime?
  status        TaskStatus         @default(PENDING)
  type          TaskType?          @default(DEFAULT) // ä»»åŠ¡ç±»å‹
  frequency     TaskFrequency? // å®šæ—¶ä»»åŠ¡é¢‘ç‡
  knowledgeId   String?            @db.VarChar(64) // å•ä¸ªæ–‡æ¡£ä»»åŠ¡ Id
  executionType TaskExecutionType? @default(CRAWLER_SERVICE) // ä»»åŠ¡æ‰§è¡Œç±»å‹
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt
  deletedAt     DateTime?

  @@index([createdAt], map: "idx_created_at")
  @@index([projectId], map: "idx_project_id")
  @@index([startTime], map: "idx_start_time")
  @@index([status], map: "idx_status")
  @@index([type], map: "idx_type")
  @@index([frequency], map: "idx_frequency")
  @@index([knowledgeId], map: "idx_knowledgeId")
  @@map("tasks")
}

model Knowledge {
  id           String          @id @db.VarChar(64)
  projectId    String          @db.VarChar(64)
  status       KnowledgeStatus @default(PENDING)
  creatorId    String          @db.VarChar(64)
  type         KnowledgeType   @default(LINK)
  name         String?         @db.VarChar(255) // Display name for files/links
  content      String          @db.Text // Source description, determined by type: file OSS link, web link, or channelId
  requestCount Int             @default(0) // Request count
  resourceId   String?         @db.VarChar(255)
  docs         String?         @db.Text
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
  deletedAt    DateTime?

  @@index([projectId], map: "knowledge_projectId_index")
  @@index([creatorId], map: "knowledge_creatorId_index")
  @@map("knowledge")
}

model Payment {
  id             String        @id @db.VarChar(255) // System generated payment ID (Primary Key)
  invoiceId      String?       @unique @db.VarChar(255) // NOWPayments invoice ID
  paymentId      String?       @unique @db.VarChar(255) // NOWPayments payment ID (generated after payment)
  clientId       String        @db.VarChar(64) // Client who made the payment
  projectId      String        @db.VarChar(64) // Related project
  amount         Decimal       @db.Decimal(20, 8) // Payment amount
  currency       String        @db.VarChar(10) // Payment currency (USD, EUR, etc.)
  payAmount      Decimal?      @db.Decimal(20, 8) // Amount to pay in crypto
  payCurrency    String?       @db.VarChar(20) // Cryptocurrency used for payment
  payAddress     String?       @db.VarChar(255) // Payment address
  status         PaymentStatus @default(PENDING)
  description    String?       @db.Text // Payment description
  returnUrl      String?       @db.VarChar(500) // Return URL after payment
  successUrl     String?       @db.VarChar(500) // Success URL
  cancelUrl      String?       @db.VarChar(500) // Cancel URL
  ipnCallbackUrl String?       @db.VarChar(500) // IPN callback URL
  metadata       String?       @db.Text // Additional metadata (JSON)
  expiresAt      DateTime? // Payment expiration time
  confirmedAt    DateTime? // Payment confirmation time
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  deletedAt      DateTime?

  @@index([clientId], map: "payment_clientId_index")
  @@index([projectId], map: "payment_projectId_index")
  @@index([status], map: "payment_status_index")
  @@index([id], map: "payment_id_index")
  @@map("payments")
}

model PaymentTransaction {
  id            String        @id @db.VarChar(64)
  paymentId     String        @db.VarChar(64) // Related payment
  txHash        String?       @db.VarChar(255) // Transaction hash
  blockNumber   String?       @db.VarChar(255) // Block number
  confirmations Int? // Number of confirmations
  amount        Decimal       @db.Decimal(20, 8) // Transaction amount
  currency      String        @db.VarChar(20) // Transaction currency
  status        PaymentStatus @default(PENDING)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  @@index([paymentId], map: "payment_transaction_paymentId_index")
  @@index([txHash], map: "payment_transaction_txHash_index")
  @@map("payment_transactions")
}

model VIPTier {
  id            Int      @id // IDåŒæ—¶è¡¨ç¤ºä¼˜å…ˆçº§ï¼Œè¶Šå¤§ç­‰çº§è¶Šé«˜
  name          String   @db.VarChar(100) // ç­‰çº§åç§° (Starter, Professional, Enterprise)
  description   String?  @db.Text // æè¿°
  monthlyPrice  Int      @default(-1) // æŒ‰æœˆä»·æ ¼ï¼ˆ-1è¡¨ç¤ºæ— æ³•ç›´æ¥å¼€é€šï¼‰
  annuallyPrice Int      @default(-1) // æŒ‰å¹´ä»·æ ¼ï¼ˆ-1è¡¨ç¤ºæ— æ³•ç›´æ¥å¼€é€šï¼‰
  limitations   String   @db.Text // JSON array: æ¯é¡¹æƒç›Šçš„é™åˆ¶æ•°é‡ï¼ˆ-1æ— ç©·ï¼Œ-2å¾…å®šï¼‰
  visible       Boolean  @default(true) // æ˜¯å¦å¯è§
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("vip_tiers")
}

model VIPRecord {
  id        String   @id @db.VarChar(64)
  projectId String   @db.VarChar(64) // é¡¹ç›®ID
  tierId    Int // VIPç­‰çº§ID
  startAt   DateTime @default(now()) // å¼€å§‹æ—¶é—´
  endAt     DateTime // ç»“æŸæ—¶é—´
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([projectId], map: "vip_record_projectId_index")
  @@index([tierId], map: "vip_record_tierId_index")
  @@index([startAt], map: "vip_record_startAt_index")
  @@index([endAt], map: "vip_record_endAt_index")
  @@map("vip_records")
}

model PromptTemplate {
  id            String             @id @db.VarChar(64)
  name          String?            @db.VarChar(255)
  description   String?            @db.Text
  type          PromptTemplateType
  version       String             @db.VarChar(64)
  systemMessage String?            @db.Text
  userMessage   String?            @db.Text
  outputFormat  String?            @db.Text
  isJsonSchema  Boolean            @default(false)
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt

  @@index([type], map: "prompt_template_type_index")
  @@index([name], map: "prompt_template_name_index")
  @@index([version], map: "prompt_template_version_index")
  @@map("prompt_templates")
}

model TokenRecord {
  id        String          @id @db.VarChar(64)
  projectId String          @db.VarChar(64)
  type      TokenChangeType
  reason    String?         @db.Text
  amount    Int // æ­£æ•°=å¢åŠ ï¼Œè´Ÿæ•°=æ¶ˆè€—
  expiresAt DateTime? // èµ é€Tokençš„è¿‡æœŸæ—¶é—´ï¼ˆnullè¡¨ç¤ºæ°¸ä¹…ï¼‰
  sourceId  String?         @db.VarChar(64) // VIPè®°å½•IDæˆ–æ”¯ä»˜ID
  createdAt DateTime        @default(now())

  @@index([projectId, createdAt], map: "token_record_project_created_index")
  @@index([projectId, expiresAt], map: "token_record_project_expires_index")
  @@index([projectId, type], map: "token_record_project_type_index")
  @@map("token_records")
}

model VibeUser {
  id            String  @id @db.VarChar(64)
  discordId     String? @db.VarChar(255)
  twitterId     String? @db.VarChar(255)
  walletAddress String? @db.VarChar(255) // é’±åŒ…åœ°å€

  // Discord è¿æ¥çŠ¶æ€
  discordConnected Boolean @default(false) // Discord OAuth æ˜¯å¦å®Œæˆ
  isJoined         Boolean @default(false) // æ˜¯å¦åŠ å…¥ 0G é¡¹ç›®æ–¹ DC
  discordUsername  String? @db.VarChar(255) // Discord ç”¨æˆ·å

  // Twitter è¿æ¥çŠ¶æ€
  twitterConnected Boolean @default(false) // Twitter OAuth æ˜¯å¦å®Œæˆ
  isFollowed       Boolean @default(false) // æ˜¯å¦å…³æ³¨ Dolly Twitter
  twitterUsername  String? @db.VarChar(255) // Twitter ç”¨æˆ·å

  // é’±åŒ…è¿æ¥çŠ¶æ€
  walletConnected  Boolean   @default(false) // é’±åŒ…æ˜¯å¦å·²éªŒè¯è¿æ¥
  walletVerifiedAt DateTime? // é’±åŒ…éªŒè¯æ—¶é—´

  // æ€»ä½“çŠ¶æ€
  allConnected Boolean   @default(false) // ä¸‰é¡¹å…¨éƒ¨è¿æ¥æˆåŠŸ
  completedAt  DateTime? // å…¨éƒ¨è¿æ¥å®Œæˆæ—¶é—´

  createdAt DateTime       @default(now()) // ç”¨æˆ·åˆ›å»ºæ—¶é—´
  updatedAt DateTime       @updatedAt // ç”¨æˆ·æ›´æ–°æ—¶é—´
  status    VibeUserStatus @default(NORMAL) // ç”¨æˆ·çŠ¶æ€ï¼ˆ0ï¼šæ­£å¸¸ï¼Œ1ï¼šé»‘åå•ï¼‰

  @@index([discordId], map: "vibe_user_discordId_index")
  @@index([twitterId], map: "vibe_user_twitterId_index")
  @@index([walletAddress], map: "vibe_user_walletAddress_index")
  @@index([status], map: "vibe_user_status_index")
  @@index([allConnected], map: "vibe_user_allConnected_index")
  @@map("vibe_users")
}

// é’±åŒ…ç­¾åéªŒè¯ä¸´æ—¶å­˜å‚¨
model WalletNonce {
  id            String   @id @db.VarChar(64)
  walletAddress String   @db.VarChar(255)
  nonce         String   @db.VarChar(255)
  message       String   @db.Text
  expiresAt     DateTime
  createdAt     DateTime @default(now())

  @@index([walletAddress], map: "wallet_nonce_address_index")
  @@index([expiresAt], map: "wallet_nonce_expires_index")
  @@map("wallet_nonces")
}

// Vibe Pass ç›¸å…³æ¨¡å‹
model VibeProject {
  id        String            @id @db.VarChar(64)
  projectId String            @db.VarChar(64) // å¯¹åº” Dolly ç³»ç»Ÿå†…çš„ Project ID
  score     Decimal           @default(0) @db.Decimal(10, 2) // é¡¹ç›®æ€»åˆ†
  status    VibeProjectStatus @default(NORMAL) // é¡¹ç›®çŠ¶æ€
  createdAt DateTime          @default(now()) // é¡¹ç›®åˆ›å»ºæ—¶é—´
  updatedAt DateTime          @updatedAt // é¡¹ç›®æ›´æ–°æ—¶é—´

  @@index([projectId], map: "vibe_project_projectId_index")
  @@index([status], map: "vibe_project_status_index")
  @@index([score], map: "vibe_project_score_index")
  @@map("vibe_projects")
}

model VibePass {
  id            String         @id @db.VarChar(64)
  vibeUserId    String         @db.VarChar(64) // VibeUser ID
  vibeProjectId String         @db.VarChar(64) // VibeProject ID
  userId        String         @db.VarChar(64) // å¯¹åº”çš„ Dolly ç³»ç»Ÿå†…çš„ User ID
  msgCount      Int            @default(0) // 24å°æ—¶å†…æ¶ˆæ¯æ•°é‡ï¼ˆç¼“å­˜ï¼‰
  inviteCount   Int            @default(0) // Discord é‚€è¯·äººæ•°ï¼ˆç¼“å­˜ï¼‰
  score         Decimal        @default(0) @db.Decimal(10, 2) // INFT æ€»ç§¯åˆ†ï¼ˆAI åˆ¤æ–­ï¼‰
  params        String         @db.Text // INFT å„é¡¹å±æ€§å€¼ï¼ˆJSON æ•°ç»„ï¼Œç”¨äºç»˜åˆ¶é›·è¾¾å›¾ï¼ŒAI åˆ¤æ–­çš„ç»´åº¦ï¼‰
  tags          String?        @db.Text // æ ‡ç­¾åˆ—è¡¨ï¼ˆJSON æ•°ç»„ï¼ŒAI åˆ¤æ–­ï¼‰
  sealedKey     String?        @db.VarChar(255) // INFT å…ƒæ•°æ® SealedKey
  rootHash      String?        @db.VarChar(255) // INFT å…ƒæ•°æ® RootHashï¼ˆä¿å­˜ç”¨æˆ·ç”»åƒã€èŠå¤©è®°å½•ï¼‰
  tokenId       String?        @db.VarChar(255) // INFT Token ID
  mintTxHash    String?        @db.VarChar(255) // INFT Mint äº¤æ˜“ Hash
  status        VibePassStatus @default(NORMAL) // ç”¨æˆ·çŠ¶æ€
  createdAt     DateTime       @default(now()) // VibePass åˆ›å»ºæ—¶é—´
  updatedAt     DateTime       @updatedAt // æ•°æ®æ›´æ–°æ—¶é—´
  mintedAt      DateTime? // INFT Mint æ—¶é—´

  @@index([vibeUserId], map: "vibe_pass_vibeUserId_index")
  @@index([vibeProjectId], map: "vibe_pass_vibeProjectId_index")
  @@index([userId], map: "vibe_pass_userId_index")
  @@index([vibeProjectId, score], map: "vibe_pass_project_score_index")
  @@index([status], map: "vibe_pass_status_index")
  @@index([tokenId], map: "vibe_pass_tokenId_index")
  @@map("vibe_passes")
}

model ProfileUpdateRecord {
  id          String    @id @db.VarChar(64)
  userId      String?   @db.VarChar(64) // User IDï¼ˆå³åŸæœ‰çš„ User è¡¨ï¼‰
  vibePassId  String?   @db.VarChar(64) // VibePass IDï¼ˆå¦‚æœè¿™ä¸ª User å·²ç»å¼€é€šäº† VibePassï¼‰
  newProfile  String    @db.Text // æ–°åˆ†æçš„ç”¨æˆ·ç”»åƒ
  newScore    Decimal?  @db.Decimal(10, 2) // æ–°åˆ†æçš„ INFT æ€»åˆ†ï¼ˆAI åˆ¤æ–­ï¼‰
  newParams   String?   @db.Text // æ–°åˆ¤æ–­çš„ INFT å„é¡¹å±æ€§å€¼ï¼ˆJSON æ•°ç»„ï¼Œç”¨äºç»˜åˆ¶é›·è¾¾å›¾ï¼ŒAI åˆ¤æ–­ï¼‰
  newTags     String?   @db.Text // æ–°åˆ¤æ–­çš„æ ‡ç­¾åˆ—è¡¨ï¼ˆJSON æ•°ç»„ï¼ŒAI åˆ¤æ–­ï¼‰
  newRootHash String?   @db.VarChar(255) // æ–° INFT å…ƒæ•°æ® RootHashï¼ˆä¿å­˜ç”¨æˆ·ç”»åƒã€èŠå¤©è®°å½•ï¼‰
  createdAt   DateTime  @default(now()) // è®°å½•åˆ›å»ºæ—¶é—´
  uploadedAt  DateTime? // å…ƒæ•°æ®ä¸Šä¼ æ—¶é—´

  @@index([userId], map: "profile_update_record_userId_index")
  @@index([vibePassId], map: "profile_update_record_vibePassId_index")
  @@index([createdAt], map: "profile_update_record_createdAt_index")
  @@map("profile_update_records")
}

model ScoreRecord {
  id             String          @id @db.VarChar(64)
  vibePassId     String          @db.VarChar(64) // VibePass ID
  vibeUserId     String          @db.VarChar(64) // VibeUser IDï¼ˆå†—ä½™å­—æ®µï¼Œä¾¿äºæŸ¥è¯¢ï¼‰
  vibeProjectId  String          @db.VarChar(64) // VibeProject IDï¼ˆå†—ä½™å­—æ®µï¼Œä¾¿äºæŸ¥è¯¢ï¼‰
  value          Decimal         @db.Decimal(10, 2) // ç§¯åˆ†å˜åŒ–æ•°é‡ï¼ˆå¯ä»¥æ˜¯æ­£æ•°æˆ–è´Ÿæ•°ï¼‰
  type           ScoreRecordType // ç§¯åˆ†å˜åŒ–ç±»å‹
  updateRecordId String?         @db.VarChar(64) // ç§¯åˆ†å˜åŒ–å¯¹åº”çš„ ProfileUpdateRecord çš„ ID
  createdAt      DateTime        @default(now()) // è®°å½•åˆ›å»ºæ—¶é—´

  @@index([vibePassId], map: "score_record_vibePassId_index")
  @@index([vibeUserId], map: "score_record_vibeUserId_index")
  @@index([vibeProjectId], map: "score_record_vibeProjectId_index")
  @@index([type], map: "score_record_type_index")
  @@index([updateRecordId], map: "score_record_updateRecordId_index")
  @@index([vibePassId, createdAt], map: "score_record_vibe_pass_created_index")
  @@index([vibeUserId, createdAt], map: "score_record_vibe_user_created_index")
  @@index([vibeProjectId, createdAt], map: "score_record_vibe_project_created_index")
  @@map("score_records")
}
